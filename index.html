<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PharmaInventory - Pharmacy Management</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #2c7be5;
            --primary-dark: #1a68d1;
            --secondary: #00d97e;
            --danger: #e63757;
            --warning: #f6c343;
            --info: #39afd1;
            --dark: #283e59;
            --light: #f9fbfd;
            --gray: #95aac9;
            --border: #e3ebf6;
            --success-bg: #d4f8e8;
            --warning-bg: #fef5e7;
            --danger-bg: #fce8e8;
            --card-shadow: 0 0.5rem 1rem rgba(46, 54, 80, 0.1);
            --sidebar-width: 250px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f5f8fa;
            color: var(--dark);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .app-container {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: var(--sidebar-width);
            background: var(--dark);
            color: white;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            transition: all 0.3s ease;
            z-index: 1000;
            transform: translateX(-100%);
        }

        .sidebar.active {
            transform: translateX(0);
        }

        .menu-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .menu-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .menu-toggle {
            display: none;
            background: transparent;
            border: none;
            font-size: 1.5rem;
            color: var(--dark);
            cursor: pointer;
            padding: 10px;
            border-radius: 5px;
            transition: all 0.3s ease;
        }

        .menu-toggle:hover {
            background: rgba(44, 123, 229, 0.1);
            color: var(--primary);
        }

        .sidebar-close {
            display: none;
            position: absolute;
            top: 20px;
            right: 20px;
            background: transparent;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 5px;
            border-radius: 3px;
            transition: all 0.3s ease;
        }

        .sidebar-close:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .logo {
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .logo h1 {
            font-size: 1.5rem;
            font-weight: 600;
            color: white;
        }

        .logo span {
            color: var(--secondary);
        }

        .nav-links {
            padding: 20px 0;
        }

        .nav-link {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: rgba(255,255,255,0.8);
            text-decoration: none;
            transition: all 0.3s;
            font-size: 1rem;
        }

        .nav-link i {
            margin-right: 12px;
            font-size: 1.2rem;
            width: 24px;
            text-align: center;
        }

        .nav-link:hover, .nav-link.active {
            background: rgba(255,255,255,0.1);
            color: white;
            border-left: 4px solid var(--secondary);
        }

        .main-content {
            flex: 1;
            margin-left: 0;
            padding: 20px;
            transition: all 0.3s ease;
            width: 100%;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            margin-bottom: 25px;
            border-bottom: 1px solid var(--border);
        }

        .header h2 {
            font-size: 1.8rem;
            font-weight: 600;
            color: var(--dark);
        }

        .search-container {
            display: flex;
            gap: 15px;
        }

        .search-box {
            position: relative;
            width: 300px;
        }

        .search-box input {
            width: 100%;
            padding: 12px 15px 12px 40px;
            border-radius: 50px;
            border: 1px solid var(--border);
            background: white;
            font-size: 1rem;
            box-shadow: var(--card-shadow);
        }

        .search-box i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray);
        }

        .btn {
            padding: 10px 20px;
            border-radius: 50px;
            border: none;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 0.95rem;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
        }

        .btn-success {
            background: var(--secondary);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-warning {
            background: var(--warning);
            color: white;
        }

        .card {
            background: white;
            border-radius: 10px;
            box-shadow: var(--card-shadow);
            margin-bottom: 25px;
            overflow: hidden;
        }

        .card-header {
            padding: 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-header h3 {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--dark);
        }

        .card-body {
            padding: 20px;
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .stat-card {
            background: white;
            border-radius: 10px;
            box-shadow: var(--card-shadow);
            padding: 20px;
            display: flex;
            align-items: center;
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            margin-right: 15px;
        }

        .stat-icon.total {
            background: rgba(44, 123, 229, 0.1);
            color: var(--primary);
        }

        .stat-icon.expiring {
            background: rgba(246, 195, 67, 0.1);
            color: var(--warning);
        }

        .stat-icon.sales {
            background: rgba(0, 217, 126, 0.1);
            color: var(--secondary);
        }

        .stat-icon.profit {
            background: rgba(230, 55, 87, 0.1);
            color: var(--danger);
        }

        .stat-info h3 {
            font-size: 1.8rem;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .stat-info p {
            color: var(--gray);
            font-size: 0.95rem;
        }

        .table-responsive {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        th {
            background: #f8fafd;
            font-weight: 600;
            color: var(--dark);
            font-size: 0.95rem;
        }

        tr:hover {
            background: #f8fafd;
        }

        .badge {
            padding: 5px 12px;
            border-radius: 50px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .badge-success {
            background: var(--success-bg);
            color: var(--secondary);
        }

        .badge-warning {
            background: var(--warning-bg);
            color: var(--warning);
        }

        .badge-danger {
            background: var(--danger-bg);
            color: var(--danger);
        }

        .action-btn {
            padding: 5px 10px;
            border-radius: 5px;
            background: transparent;
            border: none;
            cursor: pointer;
            margin: 0 3px;
            font-size: 1rem;
        }

        .action-btn.edit {
            color: var(--primary);
        }

        .action-btn.delete {
            color: var(--danger);
        }

        .action-btn.sell {
            color: var(--secondary);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark);
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border-radius: 8px;
            border: 1px solid var(--border);
            background: white;
            font-size: 1rem;
            transition: all 0.3s;
        }

        .form-control:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(44, 123, 229, 0.2);
        }

        .row {
            display: flex;
            flex-wrap: wrap;
            margin: 0 -10px;
        }

        .col {
            flex: 1;
            padding: 0 10px;
        }

        .col-3 {
            flex: 0 0 33.3333%;
            max-width: 33.3333%;
            padding: 0 10px;
        }

        .col-4 {
            flex: 0 0 25%;
            max-width: 25%;
            padding: 0 10px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .modal-close {
            background: transparent;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray);
        }

        .modal-body {
            padding: 20px;
            max-height: 70vh;
            overflow-y: auto;
        }

        .modal-footer {
            padding: 15px 20px;
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border-radius: 0 0 10px 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            z-index: 100;
            max-height: 300px;
            overflow-y: auto;
            display: none;
        }

        .search-results.show {
            display: block;
        }

        .search-item {
            padding: 12px 15px;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
            transition: all 0.2s;
        }

        .search-item:hover {
            background: #f8fafd;
        }

        .search-item h4 {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 3px;
        }

        .search-item p {
            font-size: 0.9rem;
            color: var(--gray);
            margin-bottom: 0;
        }

        @media (max-width: 992px) {
            .menu-toggle {
                display: block;
            }

            .sidebar-close {
                display: block;
            }

            .sidebar {
                width: 280px;
                transform: translateX(-100%);
            }

            .sidebar.active {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .col, .col-3, .col-4 {
                flex: 0 0 100%;
                max-width: 100%;
            }
        }

        @media (min-width: 993px) {
            .menu-toggle {
                display: none;
            }

            .sidebar {
                transform: translateX(0);
            }

            .main-content {
                margin-left: var(--sidebar-width);
            }

            .sidebar-close {
                display: none;
            }
        }

        @media (max-width: 768px) {
            .stats-container {
                grid-template-columns: 1fr;
            }

            .search-container {
                flex-direction: column;
            }

            .search-box {
                width: 100%;
            }

            .header {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }

            .header > div:first-child {
                width: 100%;
                display: flex;
                justify-content: space-between;
                align-items: center;
            }
        }

        .toast-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 3000;
        }

        .toast {
            background: white;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            padding: 15px 20px;
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            animation: slideIn 0.3s, fadeOut 0.5s 2.5s;
            border-left: 4px solid var(--primary);
        }

        .toast.success {
            border-left-color: var(--secondary);
        }

        .toast.error {
            border-left-color: var(--danger);
        }

        .toast.warning {
            border-left-color: var(--warning);
        }

        .toast i {
            font-size: 1.5rem;
            margin-right: 15px;
        }

        .toast-content h4 {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 3px;
        }

        .toast-content p {
            font-size: 0.9rem;
            color: var(--gray);
            margin-bottom: 0;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes fadeOut {
            from {
                opacity: 1;
            }
            to {
                opacity: 0;
            }
        }

        .selling-row {
            background-color: rgba(0, 217, 126, 0.1) !important;
        }

        .expiring-row {
            background-color: rgba(246, 195, 67, 0.1) !important;
        }

        .page-content {
            display: none;
        }

        .page-content.active {
            display: block;
        }

        .expiry-alert {
            background-color: var(--warning-bg);
            border-left: 4px solid var(--warning);
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 4px;
        }

        .expiry-alert.critical {
            background-color: var(--danger-bg);
            border-left: 4px solid var(--danger);
        }

        .sale-card {
            background: white;
            border-radius: 10px;
            box-shadow: var(--card-shadow);
            padding: 20px;
            margin-bottom: 20px;
        }

        .sale-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border);
        }

        .sale-items {
            margin-bottom: 15px;
        }

        .sale-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid var(--border);
        }

        .sale-total {
            font-weight: 600;
            font-size: 1.2rem;
            text-align: right;
            padding-top: 10px;
        }

        .chart-container {
            background: white;
            border-radius: 10px;
            box-shadow: var(--card-shadow);
            padding: 20px;
            margin-bottom: 25px;
            height: 300px;
            position: relative;
        }

        .chart-placeholder {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: var(--gray);
            font-size: 1.2rem;
        }

        /* Invoice page */
        .invoice-controls {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            gap: 15px;
            flex-wrap: wrap;
        }

        .invoice-search {
            flex: 1;
            max-width: 400px;
        }

        .invoice-card {
            background: white;
            border-radius: 10px;
            box-shadow: var(--card-shadow);
            padding: 20px;
            margin-bottom: 20px;
            transition: all 0.3s;
            cursor: pointer;
            border-left: 4px solid var(--primary);
        }

        .invoice-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .invoice-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border);
        }

        .invoice-id {
            font-weight: 600;
            color: var(--primary);
        }

        .invoice-date {
            color: var(--gray);
        }

        .invoice-customer {
            margin-bottom: 10px;
            font-weight: 500;
        }

        .invoice-items {
            margin-bottom: 15px;
        }

        .invoice-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px dashed var(--border);
        }

        .invoice-item:last-child {
            border-bottom: none;
        }

        .invoice-total {
            font-weight: 600;
            font-size: 1.2rem;
            text-align: right;
            padding-top: 10px;
            border-top: 2px solid var(--border);
        }

        .invoice-status {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 50px;
            font-size: 0.85rem;
            font-weight: 500;
            margin-top: 10px;
        }

        .invoice-status.paid {
            background: var(--success-bg);
            color: var(--secondary);
        }

        .invoice-status.pending {
            background: var(--warning-bg);
            color: var(--warning);
        }

        .invoice-details-modal .modal-content {
            max-width: 800px;
        }

        .invoice-details {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }

        .invoice-header-details {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border);
        }

        .invoice-logo {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary);
        }

        .invoice-info {
            text-align: right;
        }

        .invoice-title {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 5px;
            color: var(--dark);
        }

        .invoice-meta {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .invoice-from, .invoice-to {
            background: #f9fbfd;
            padding: 15px;
            border-radius: 8px;
        }

        .invoice-section-title {
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--dark);
            border-bottom: 1px solid var(--border);
            padding-bottom: 5px;
        }

        .invoice-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 30px;
        }

        .invoice-table th {
            background: #f8fafd;
            padding: 12px 15px;
            text-align: left;
            border-bottom: 2px solid var(--border);
            font-weight: 600;
            color: var(--dark);
        }

        .invoice-table td {
            padding: 12px 15px;
            border-bottom: 1px solid var(--border);
        }

        .invoice-table tfoot td {
            padding-top: 15px;
            font-weight: 600;
            border-bottom: none;
        }

        .text-right {
            text-align: right;
        }

        .invoice-summary {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .invoice-totals {
            background: #f9fbfd;
            padding: 20px;
            border-radius: 8px;
        }

        .invoice-total-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px dashed var(--border);
        }

        .invoice-total-row:last-child {
            border-bottom: none;
            font-weight: 700;
            font-size: 1.2rem;
            margin-top: 10px;
            padding-top: 15px;
            border-top: 2px solid var(--border);
        }

        .invoice-actions {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid var(--border);
        }

        .print-only {
            display: none;
        }

        @media print {
            body * {
                visibility: hidden;
            }
            .invoice-details, .invoice-details * {
                visibility: visible;
            }
            .invoice-details {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                box-shadow: none;
            }
            .no-print {
                display: none;
            }
            .print-only {
                display: block;
                text-align: center;
                margin-top: 20px;
                font-size: 0.9rem;
                color: var(--gray);
            }
        }

        /* Data management */
        .data-management {
            margin-top: 30px;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: var(--card-shadow);
        }

        .data-buttons {
            display: flex;
            gap: 15px;
            margin-top: 15px;
        }

        .backup-notice {
            background: var(--warning-bg);
            border-left: 4px solid var(--warning);
            padding: 15px;
            margin-top: 20px;
            border-radius: 4px;
        }

        .storage-info {
            display: flex;
            align-items: center;
            padding: 10px;
            background: rgba(44, 123, 229, 0.1);
            border-radius: 8px;
            margin-top: 15px;
            font-size: 0.9rem;
        }

        .storage-info i {
            margin-right: 10px;
            color: var(--primary);
            font-size: 1.2rem;
        }

        /* Unit badge */
        .unit-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            background: #e9ecef;
            margin-right: 5px;
        }

        /* Stock display */
        .stock-display {
            display: flex;
            flex-direction: column;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Menu Overlay -->
        <div class="menu-overlay" id="menuOverlay"></div>
        
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <button class="sidebar-close" id="sidebarClose">
                <i class="fas fa-times"></i>
            </button>
            <div class="logo">
                <h1>Pharma<span>Inventory</span></h1>
            </div>
            <div class="nav-links">
                <a href="#" class="nav-link active" data-page="dashboard">
                    <i class="fas fa-home"></i>
                    <span>Dashboard</span>
                </a>
                <a href="#" class="nav-link" data-page="inventory">
                    <i class="fas fa-pills"></i>
                    <span>Inventory</span>
                </a>
                <a href="#" class="nav-link" data-page="add-medicine">
                    <i class="fas fa-plus-circle"></i>
                    <span>Add Medicine</span>
                </a>
                <a href="#" class="nav-link" data-page="low-stocks">
                    <i class="fas fa-exclamation-triangle"></i>
                    <span>Low Stocks</span>
                </a>
                <a href="#" class="nav-link" data-page="invoices">
                    <i class="fas fa-file-invoice"></i>
                    <span>Invoices</span>
                </a>
                <a href="#" class="nav-link" data-page="expiry">
                    <i class="fas fa-exclamation-triangle"></i>
                    <span>Expiry Alerts</span>
                </a>
                <a href="#" class="nav-link" data-page="reports">
                    <i class="fas fa-chart-bar"></i>
                    <span>Reports</span>
                </a>
                <a href="#" class="nav-link" data-page="settings">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </a>
                <a href="#" class="nav-link" data-page="backup">
                    <i class="fas fa-database"></i>
                    <span>Data Backup</span>
                </a>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Header -->
            <div class="header">
                <div style="display: flex; align-items: center; gap: 15px;">
                    <button class="menu-toggle" id="menuToggle">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h2 id="page-title">Dashboard</h2>
                </div>
                <div class="search-container">
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" id="globalSearch" placeholder="Search medicines...">
                        <div class="search-results" id="searchResults"></div>
                    </div>
                    <button class="btn btn-primary" id="syncData">
                        <i class="fas fa-sync-alt"></i> Sync Data
                    </button>
                </div>
            </div>

            <!-- Dashboard Content -->
            <div id="dashboard" class="page-content active">
                <!-- Stats Cards -->
                <div class="stats-container">
                    <div class="stat-card" id="totalMedicinesCard" style="cursor: pointer;" title="Click to view inventory">
                        <div class="stat-icon total">
                            <i class="fas fa-pills"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="totalMedicines">0</h3>
                            <p>Total Medicines</p>
                        </div>
                    </div>
                    <div class="stat-card" id="expiringSoonCard" style="cursor: pointer;" title="Click to view expiry alerts">
                        <div class="stat-icon expiring">
                            <i class="fas fa-exclamation-circle"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="expiringSoon">0</h3>
                            <p>Expiring Soon</p>
                        </div>
                    </div>
                    <div class="stat-card" id="todaySalesCard" style="cursor: pointer;" title="Click to view invoices">
                        <div class="stat-icon sales">
                            <i class="fas fa-shopping-cart"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="todaySales">৳0</h3>
                            <p>Today's Sales</p>
                        </div>
                    </div>
                    <div class="stat-card" id="monthlyProfitCard" style="cursor: pointer;" title="Click to view reports">
                        <div class="stat-icon profit">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="monthlyProfit">৳0</h3>
                            <p>Monthly Profit</p>
                        </div>
                    </div>
                </div>

                <!-- Inventory Table -->
                <div class="card">
                    <div class="card-header">
                        <h3>RecentInventory</h3>
                        <button class="btn btn-primary" id="viewAllInventory">
                            <i class="fas fa-list"></i> View All
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table id="recentInventoryTable">
                                <thead>
                                    <tr>
                                        <th>Medicine</th>
                                        <th>Generic</th>
                                        <th>Type</th>
                                        <th>Stock</th>
                                        <th>Price</th>
                                        <th>Expiry</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Data will be populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Recent Sales -->
                <div class="card">
                    <div class="card-header">
                        <h3>Recent Sales</h3>
                        <button class="btn btn-primary" id="viewAllSales">
                            <i class="fas fa-list"></i> View All
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table id="recentSalesTable">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Medicine</th>
                                        <th>Quantity</th>
                                        <th>Price</th>
                                        <th>Total</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Data will be populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Inventory Content -->
            <div id="inventory" class="page-content">
                <div class="card">
                    <div class="card-header">
                        <h3>Medicine Inventory</h3>
                        <div class="search-container">
                            <div class="search-box">
                                <i class="fas fa-search"></i>
                                <input type="text" id="inventorySearch" placeholder="Search inventory...">
                            </div>
                            <button class="btn btn-primary" id="exportInventory">
                                <i class="fas fa-file-export"></i> Export
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table id="inventoryTable">
                                <thead>
                                    <tr>
                                        <th>Medicine</th>
                                        <th>Generic</th>
                                        <th>Type</th>
                                        <th>Power</th>
                                        <th>Company</th>
                                        <th>Stock</th>
                                        <th>Price</th>
                                        <th>Expiry</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Data will be populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Add Medicine Content -->
            <div id="add-medicine" class="page-content">
                <div class="card">
                    <div class="card-header">
                        <h3>Add New Medicine</h3>
                    </div>
                    <div class="card-body">
                        <form id="addMedicineForm">
                            
                            <div class="form-group">
                                        <label for="medicineName">Medicine Name *</label>
                                        <div class="search-box" style="position: relative;">
                                            <input type="text" id="medicineName" class="form-control" required autocomplete="off">
                                            <div class="search-results" id="medicineNameSuggestions" style="position: absolute; top: 100%; left: 0; right: 0; background: white; border: 1px solid var(--border); border-top: none; border-radius: 0 0 8px 8px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); z-index: 100; max-height: 300px; overflow-y: auto; display: none;">
                                                <!-- Suggestions will be populated here -->
                                            </div>
                                        </div>
                                    </div>
                                
                            <div class="row">
                                <div class="col">
                                    <div class="form-group">
                                        <label for="genericName">Generic Name</label>
                                        <input type="text" id="genericName" class="form-control">
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col">
                                    <div class="form-group">
                                        <label for="medicineType">Type</label>
                                        <select id="medicineType" class="form-control">
                                            <option value="tablet">Tablet</option>
                                            <option value="capsule">Capsule</option>
                                            <option value="syrup">Syrup</option>
                                            <option value="suspension">Suspension</option>
                                            <option value="drop">Drop</option>
                                            <option value="injection">Injection</option>
                                            <option value="cream">Cream</option>
                                            <option value="ointment">Ointment</option>
                                            <option value="gel">Gel</option>
                                            <option value="powder">Powder</option>
                                            <option value="inhaler">Inhaler</option>
                                            <option value="suppository">Suppository</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col">
                                    <div class="form-group">
                                        <label for="power">Power/Strength</label>
                                        <input type="text" id="power" class="form-control">
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col">
                                    <div class="form-group">
                                        <label for="company">Company</label>
                                        <input type="text" id="company" class="form-control">
                                    </div>
                                </div>
                                <div class="col">
                                    <div class="form-group">
                                        <label for="boxPrice">Box Price (৳) *</label>
                                        <input type="number" id="boxPrice" class="form-control" min="0.01" step="0.01" required>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col">
                                    <div class="form-group">
                                        <label for="stripsPerBox">Strips per Box *</label>
                                        <input type="number" id="stripsPerBox" class="form-control" min="1" required>
                                    </div>
                                </div>
                                <div class="col">
                                    <div class="form-group">
                                        <label for="piecesPerStrip">Pieces per Strip *</label>
                                        <input type="number" id="piecesPerStrip" class="form-control" min="1" required>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-4">
                                    <div class="form-group">
                                        <label for="boxes">Boxes</label>
                                        <input type="number" id="boxes" class="form-control" min="0" value="0">
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="form-group">
                                        <label for="strips">Strips</label>
                                        <input type="number" id="strips" class="form-control" min="0" value="0">
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="form-group">
                                        <label for="pieces">Pieces</label>
                                        <input type="number" id="pieces" class="form-control" min="0" value="0">
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col">
                                    <div class="form-group">
                                        <label for="expiryDate">Expiry Date *</label>
                                        <input type="date" id="expiryDate" class="form-control" required>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <button type="submit" class="btn btn-success">
                                    <i class="fas fa-plus-circle"></i> Add to Inventory
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Low Stocks Content -->
            <div id="low-stocks" class="page-content">
                <div class="card">
                    <div class="card-header">
                        <h3>Low Stock Medicines</h3>
                        <div class="search-container">
                            <div class="search-box">
                                <i class="fas fa-search"></i>
                                <input type="text" id="lowStockSearch" placeholder="Search low stock medicines...">
                            </div>
                            <button class="btn btn-warning" id="exportLowStock">
                                <i class="fas fa-file-export"></i> Export Low Stock
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table id="lowStockTable">
                                <thead>
                                    <tr>
                                        <th>Medicine</th>
                                        <th>Generic</th>
                                        <th>Type</th>
                                        <th>Company</th>
                                        <th>Current Stock</th>
                                        <th>Price</th>
                                        <th>Expiry</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Low stock medicines will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Invoices Page -->
            <div id="invoices" class="page-content">
                <div class="card">
                    <div class="card-header">
                        <h3>Sales Invoices</h3>
                        <button class="btn btn-primary" id="createInvoice">
                            <i class="fas fa-plus-circle"></i> Create Invoice
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="invoice-controls">
                            <div class="search-box invoice-search">
                                <i class="fas fa-search"></i>
                                <input type="text" id="invoiceSearch" placeholder="Search invoices...">
                            </div>
                            <div>
                                <button class="btn btn-primary" id="printAllInvoices">
                                    <i class="fas fa-print"></i> Print All
                                </button>
                                <button class="btn btn-success" id="exportInvoices">
                                    <i class="fas fa-file-export"></i> Export
                                </button>
                            </div>
                        </div>

                        <div id="invoicesList">
                            <!-- Invoices will be populated here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Expiry Alerts -->
            <div id="expiry" class="page-content">
                <div class="card">
                    <div class="card-header">
                        <h3>Expiry Alerts</h3>
                    </div>
                    <div class="card-body">
                        <div id="expiryAlerts">
                            <!-- Alerts will be populated here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Reports -->
            <div id="reports" class="page-content">
                <div class="card">
                    <div class="card-header">
                        <h3>Sales Reports</h3>
                    </div>
                    <div class="card-body">
                        <div class="stats-container">
                            <div class="stat-card" id="weeklySalesCard" style="cursor: pointer;" title="Click to view weekly chart">
                                <div class="stat-icon sales">
                                    <i class="fas fa-shopping-cart"></i>
                                </div>
                                <div class="stat-info">
                                    <h3 id="weeklySales">৳0</h3>
                                    <p>Weekly Sales</p>
                                </div>
                            </div>
                            <div class="stat-card" id="monthlyRevenueCard" style="cursor: pointer;" title="Click to view monthly chart">
                                <div class="stat-icon profit">
                                    <i class="fas fa-chart-line"></i>
                                </div>
                                <div class="stat-info">
                                    <h3 id="monthlyRevenue">৳0</h3>
                                    <p>Monthly Revenue</p>
                                </div>
                            </div>
                            <div class="stat-card" id="dailySalesCard" style="cursor: pointer;" title="Click to view daily sales chart">
                                <div class="stat-icon total">
                                    <i class="fas fa-calendar-day"></i>
                                </div>
                                <div class="stat-info">
                                    <h3 id="topSelling">N/A</h3>
                                    <p>Top Selling Medicine</p>
                                </div>
                            </div>
                        </div>

                        <div class="chart-container">
                            <h4 id="chartTitle">Top Selling Medicines</h4>
                            <canvas id="salesChart"></canvas>
                        </div>

                        <!-- Daily Sales Chart -->
                        <div class="card">
                            <div class="card-header">
                                <h3>Daily Sales Chart (Last 30 Days)</h3>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="dailySalesChart"></canvas>
                                </div>
                            </div>
                        </div>

                        <!-- Daily Sales Report -->
                        <div class="card">
                            <div class="card-header">
                                <h3>Daily Sales Report</h3>
                            </div>
                            <div class="card-body">
                                <div class="form-group">
                                    <label for="reportDate">Select Date</label>
                                    <input type="date" id="reportDate" class="form-control" style="max-width: 200px;">
                                </div>

                                <div class="table-responsive">
                                    <table class="table">
                                        <thead>
                                            <tr>
                                                <th>Invoice #</th>
                                                <th>Customer</th>
                                                <th>Items</th>
                                                <th>Amount</th>
                                                <th>Time</th>
                                            </tr>
                                        </thead>
                                        <tbody id="dailySalesBody">
                                            <!-- Daily sales will be populated here -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings -->
            <div id="settings" class="page-content">
                <div class="card">
                    <div class="card-header">
                        <h3>System Settings</h3>
                    </div>
                    <div class="card-body">
                        <form>
                            <div class="row">
                                <div class="col">
                                    <div class="form-group">
                                        <label for="companyName">Pharmacy Name</label>
                                        <input type="text" id="companyName" class="form-control" value="City Pharmacy">
                                    </div>
                                </div>
                                <div class="col">
                                    <div class="form-group">
                                        <label for="currency">Currency</label>
                                        <select id="currency" class="form-control">
                                            <option>৳ BDT</option>
                                            <option>$ USD</option>
                                            <option>€ EUR</option>
                                            <option>₹ INR</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col">
                                    <div class="form-group">
                                        <label for="expiryThreshold">Expiry Alert Threshold (days)</label>
                                        <input type="number" id="expiryThreshold" class="form-control" value="30" min="1">
                                    </div>
                                </div>
                                <div class="col">
                                    <div class="form-group">
                                        <label for="lowStock">Low Stock Threshold</label>
                                        <input type="number" id="lowStock" class="form-control" value="10" min="1">
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <button type="button" class="btn btn-primary" id="saveSettings">
                                    <i class="fas fa-save"></i> Save Settings
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Data Backup Page -->
            <div id="backup" class="page-content">
                <div class="card">
                    <div class="card-header">
                        <h3>Data Management</h3>
                    </div>
                    <div class="card-body">
                        <div class="storage-info">
                            <i class="fas fa-database"></i>
                            <div>Your data is automatically saved in your browser's storage. 
                                Use the buttons below to backup or restore your data.</div>
                        </div>

                        <div class="data-management">
                            <h4>Backup and Restore</h4>
                            <p>Manage your pharmacy data with these tools:</p>

                            <div class="data-buttons">
                                <button class="btn btn-primary" id="backupData">
                                    <i class="fas fa-download"></i> Backup Data
                                </button>
                                <button class="btn btn-success" id="restoreData">
                                    <i class="fas fa-upload"></i> Restore Data
                                </button>
                                <button class="btn btn-danger" id="clearData">
                                    <i class="fas fa-trash"></i> Clear All Data
                                </button>
                            </div>

                            <div class="backup-notice">
                                <p><strong>Important:</strong> Backing up your data creates a downloadable file that 
                                you can use to restore your pharmacy data on any device.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Toast Container -->
            <div class="toast-container" id="toastContainer"></div>
        </div>
    </div>

    <!-- Sell Medicine Modal -->
    <div class="modal" id="sellModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Sell Medicine</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="sellMedicineForm">
                    <div class="form-group">
                        <label for="sellMedicineName">Medicine</label>
                        <input type="text" id="sellMedicineName" class="form-control" readonly>
                    </div>

                    <div class="row">
                        <div class="col">
                            <div class="form-group">
                                <label for="sellUnit">Unit</label>
                                <select id="sellUnit" class="form-control">
                                    <option value="piece">Piece</option>
                                    <option value="strip">Strip</option>
                                    <option value="box">Box</option>
                                </select>
                            </div>
                        </div>
                        <div class="col">
                            <div class="form-group">
                                <label for="sellQuantity">Quantity *</label>
                                <input type="number" id="sellQuantity" class="form-control" min="1" required>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col">
                            <div class="form-group">
                                <label for="sellPrice">Price per unit (৳)</label>
                                <input type="number" id="sellPrice" class="form-control" min="0.01" step="0.01" required>
                            </div>
                        </div>
                        <div class="col">
                            <div class="form-group">
                                <label for="sellDate">Sale Date</label>
                                <input type="date" id="sellDate" class="form-control" required>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary modal-close">Cancel</button>
                <button class="btn btn-success" id="confirmSell">Sell Medicine</button>
            </div>
        </div>
    </div>

    <!-- Invoice Details Modal -->
    <div class="modal invoice-details-modal" id="invoiceModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Invoice Details</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="invoice-details" id="invoiceDetails">
                    <!-- Invoice content will be populated here -->
                </div>
            </div>
            <div class="modal-footer no-print">
                <button class="btn btn-secondary modal-close">Close</button>
                <button class="btn btn-primary" id="printInvoice">
                    <i class="fas fa-print"></i> Print Invoice
                </button>
            </div>
        </div>
    </div>

    <!-- Create Invoice Modal -->
    <div class="modal" id="createInvoiceModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Create New Invoice</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="invoiceForm">
                    <div class="row">
                        <div class="col">
                            <div class="form-group">
                                <label for="customerName">Customer Name *</label>
                                <input type="text" id="customerName" class="form-control" required>
                            </div>
                        </div>
                        <div class="col">
                            <div class="form-group">
                                <label for="customerPhone">Phone Number</label>
                                <input type="tel" id="customerPhone" class="form-control">
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="customerAddress">Address</label>
                        <textarea id="customerAddress" class="form-control" rows="2"></textarea>
                    </div>

                    <div class="form-group">
                        <label for="invoiceDate">Invoice Date *</label>
                        <input type="date" id="invoiceDate" class="form-control" required>
                    </div>

                    <div class="form-group">
                        <label>Add Medicines</label>
                        <div class="search-box">
                            <i class="fas fa-search"></i>
                            <input type="text" id="medicineSearch" placeholder="Search medicines...">
                            <div class="search-results" id="medicineSearchResults"></div>
                        </div>
                    </div>

                    <div class="table-responsive">
                        <table id="invoiceItemsTable">
                            <thead>
                                <tr>
                                    <th>Medicine</th>
                                    <th>Unit</th>
                                    <th>Price</th>
                                    <th>Quantity</th>
                                    <th>Total</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Items will be added here -->
                            </tbody>
                            <tfoot>
                                <tr>
                                    <td colspan="4" class="text-right">Subtotal</td>
                                    <td id="subtotalAmount">৳0.00</td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <td colspan="4" class="text-right">Discount</td>
                                    <td>
                                        <input type="number" id="discount" class="form-control" min="0" value="0" step="0.01" style="width: 100px; display: inline-block;">
                                        <select id="discountType" class="form-control" style="width: 100px; display: inline-block; margin-left: 10px;">
                                            <option value="fixed">৳</option>
                                            <option value="percent">%</option>
                                        </select>
                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <td colspan="4" class="text-right">Total</td>
                                    <td id="totalAmount">৳0.00</td>
                                    <td></td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary modal-close">Cancel</button>
                <button class="btn btn-success" id="saveInvoice">Save Invoice</button>
            </div>
        </div>
    </div>

    <!-- Data Import Modal -->
    <div class="modal" id="importModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Restore Data</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Select backup file to restore:</label>
                    <input type="file" id="importFile" class="form-control" accept=".json">
                </div>
                <div class="form-group">
                    <div class="form-check">
                        <input type="checkbox" id="replaceData" class="form-check-input">
                        <label class="form-check-label" for="replaceData">Replace existing data (otherwise merge)</label>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary modal-close">Cancel</button>
                <button class="btn btn-success" id="confirmImport">Restore Data</button>
            </div>
        </div>
    </div>

    <script>
        // Data keys for localStorage
        const DATA_KEYS = {
            MEDICINES: 'pharmainventory_medicines',
            RECENT_SALES: 'pharmainventory_recent_sales',
            INVOICES: 'pharmainventory_invoices',
            NEXT_INVOICE_ID: 'pharmainventory_next_invoice_id',
            SETTINGS: 'pharmainventory_settings'
        };

        // Default settings
        const defaultSettings = {
            companyName: 'City Pharmacy',
            currency: '৳ BDT',
            expiryThreshold: 30,
            lowStock: 10
        };

        // Load settings from localStorage or use default
        function loadSettings() {
            let settings = loadFromStorage(DATA_KEYS.SETTINGS);
            if (!settings) {
                settings = defaultSettings;
                saveToStorage(DATA_KEYS.SETTINGS, settings);
            }
            return settings;
        }

        // Save settings to localStorage
        function saveSettings(settings) {
            saveToStorage(DATA_KEYS.SETTINGS, settings);
        }

        // Initialize data from localStorage or use sample data
        function loadData() {
            return {
                medicines: loadFromStorage(DATA_KEYS.MEDICINES) || [
                    {
                        id: 1,
                        name: "A-Cold",
                        generic_name: "Bromhexine Hydrochloride",
                        type: "allopathic",
                        power: "4 mg/5 ml",
                        company: "ACME Laboratories Ltd.",
                        boxPrice: 450.00,
                        stripsPerBox: 10,
                        piecesPerStrip: 10,
                        price: 4.50,
                        stock: 100,
                        expiry: "2024-12-15",
                        status: "In Stock"
                    },
                    {
                        id: 2,
                        name: "A-Cof",
                        generic_name: "Dextromethorphan + Pseudoephedrine + Triprolidine",
                        type: "allopathic",
                        power: "(10 mg+30 mg+1.25 mg)/5 ml",
                        company: "ACME Laboratories Ltd.",
                        boxPrice: 850.00,
                        stripsPerBox: 10,
                        piecesPerStrip: 10,
                        price: 8.50,
                        stock: 120,
                        expiry: "2024-11-30",
                        status: "In Stock"
                    },
                    {
                        id: 3,
                        name: "A-Clox",
                        generic_name: "Cloxacillin Sodium",
                        type: "allopathic",
                        power: "500 mg/vial",
                        company: "ACME Laboratories Ltd.",
                        boxPrice: 1421.50,
                        stripsPerBox: 5,
                        piecesPerStrip: 10,
                        price: 28.43,
                        stock: 50,
                        expiry: "2024-10-20",
                        status: "In Stock"
                    }
                ],
                recentSales: loadFromStorage(DATA_KEYS.RECENT_SALES) || [
                    {id: 1, date: '2023-07-15', name: 'A-Cold', unit: 'piece', quantity: 2, pricePerUnit: 4.50, total: 9.00},
                    {id: 2, date: '2023-07-15', name: 'A-Cof', unit: 'piece', quantity: 1, pricePerUnit: 8.50, total: 8.50},
                    {id: 3, date: '2023-07-14', name: 'A-Clox', unit: 'piece', quantity: 1, pricePerUnit: 28.43, total: 28.43}
                ],
                invoices: loadFromStorage(DATA_KEYS.INVOICES) || [
                    {
                        id: 1,
                        invoiceNumber: 'INV-2023-001',
                        date: '2023-07-15',
                        customer: {
                            name: 'Rahim Khan',
                            phone: '01712345678',
                            address: '123 Main St, Dhaka'
                        },
                        items: [
                            { id: 1, name: 'A-Cold', unit: 'piece', price: 4.50, quantity: 2, total: 9.00 },
                            { id: 2, name: 'A-Cof', unit: 'piece', price: 8.50, quantity: 1, total: 8.50 }
                        ],
                        subtotal: 17.50,
                        discount: 0.00,
                        total: 17.50,
                        status: 'paid'
                    },
                    {
                        id: 2,
                        invoiceNumber: 'INV-2023-002',
                        date: '2023-07-14',
                        customer: {
                            name: 'Karim Ahmed',
                            phone: '01987654321',
                            address: '456 Market Rd, Chittagong'
                        },
                        items: [
                            { id: 3, name: 'A-Clox', unit: 'piece', price: 28.43, quantity: 1, total: 28.43 }
                        ],
                        subtotal: 28.43,
                        discount: 10.00,
                        total: 18.43,
                        status: 'pending'
                    }
                ],
                nextInvoiceId: loadFromStorage(DATA_KEYS.NEXT_INVOICE_ID) || 3,
                settings: loadSettings()
            };
        }

        // Helper function to load from localStorage
        function loadFromStorage(key) {
            const data = localStorage.getItem(key);
            return data ? JSON.parse(data) : null;
        }

        // Helper function to save to localStorage
        function saveToStorage(key, data) {
            localStorage.setItem(key, JSON.stringify(data));
        }

        // Save all data to localStorage
        function saveAllData() {
            saveToStorage(DATA_KEYS.MEDICINES, medicines);
            saveToStorage(DATA_KEYS.RECENT_SALES, recentSales);
            saveToStorage(DATA_KEYS.INVOICES, invoices);
            saveToStorage(DATA_KEYS.NEXT_INVOICE_ID, nextInvoiceId);
            saveToStorage(DATA_KEYS.SETTINGS, settings);
        }

        // Backup data as JSON file
        function backupData() {
            const data = {
                medicines,
                recentSales,
                invoices,
                nextInvoiceId,
                settings,
                timestamp: new Date().toISOString()
            };

            const dataStr = JSON.stringify(data, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);

            const a = document.createElement('a');
            a.href = url;
            a.download = `pharmainventory-backup-${new Date().toISOString().slice(0, 10)}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);

            showToast('Data backup downloaded successfully!', 'success');
        }

        // Get price based on unit
        function getPriceByUnit(medicine, unit) {
            switch(unit) {
                case 'box': return medicine.boxPrice;
                case 'strip': return medicine.boxPrice / medicine.stripsPerBox;
                case 'piece': return medicine.price;
                default: return medicine.price;
            }
        }

        // Get pieces based on unit
        function getPiecesByUnit(medicine, unit, quantity) {
            switch(unit) {
                case 'box': return quantity * medicine.stripsPerBox * medicine.piecesPerStrip;
                case 'strip': return quantity * medicine.piecesPerStrip;
                case 'piece': return quantity;
                default: return quantity;
            }
        }

        // Format currency
        function formatCurrency(amount) {
            return `${settings.currency.split(' ')[0]}${amount.toFixed(2)}`;
        }

        // Format date as DD/MM/YYYY
        function formatDate(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            return date.toLocaleDateString('en-GB');
        }

        // Get status badge class
        function getStatusClass(status) {
            switch(status) {
                case 'Expiring Soon': return 'badge-warning';
                case 'Low Stock': return 'badge-warning';
                case 'Out of Stock': return 'badge-danger';
                default: return 'badge-success';
            }
        }

        // Show toast notification
        function showToast(message, type = 'info') {
            const container = document.getElementById('toastContainer');
            const icons = {
                info: 'fas fa-info-circle',
                success: 'fas fa-check-circle',
                error: 'fas fa-exclamation-circle',
                warning: 'fas fa-exclamation-triangle'
            };

            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <i class="${icons[type]}"></i>
                <div class="toast-content">
                    <h4>${type.charAt(0).toUpperCase() + type.slice(1)}</h4>
                    <p>${message}</p>
                </div>
            `;

            container.appendChild(toast);

            // Remove toast after animation
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // Initialize data
        let { medicines, recentSales, invoices, nextInvoiceId, settings } = loadData();

        // Current invoice being created
        let currentInvoiceItems = [];

        // Function to delete an invoice
        function deleteInvoice(invoiceId) {
            if (confirm('Are you sure you want to delete this invoice?')) {
                invoices = invoices.filter(invoice => invoice.id !== invoiceId);
                saveAllData();
                populateInvoicesList();
                showToast('Invoice deleted successfully!', 'success');
            }
        }

        // Update the invoice items table
        function updateInvoiceItemsTable() {            const tbody = document.querySelector('#invoiceItemsTable tbody');
            tbody.innerHTML = '';

            currentInvoiceItems.forEach((item, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.name}</td>
                    <td>
                        <select class="form-control unit-select" data-index="${index}">
                            <option value="piece" ${item.unit === 'piece' ? 'selected' : ''}>Piece</option>
                            <option value="strip" ${item.unit === 'strip' ? 'selected' : ''}>Strip</option>
                            <option value="box" ${item.unit === 'box' ? 'selected' : ''}>Box</option>
                        </select>
                    </td>
                    <td>${formatCurrency(item.price)}</td>
                    <td>
                        <input type="number" class="form-control quantity-input" 
                               min="1" value="${item.quantity}" 
                               data-index="${index}" style="width: 80px;">
                    </td>
                    <td>${formatCurrency(item.total)}</td>
                    <td>
                        <button class="btn btn-danger btn-sm remove-item" data-index="${index}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });

            // Add event listeners to quantity inputs
            document.querySelectorAll('.quantity-input').forEach(input => {
                input.addEventListener('change', function() {
                    const index = parseInt(this.dataset.index);
                    const newQuantity = parseInt(this.value) || 1;
                    currentInvoiceItems[index].quantity = newQuantity;
                    currentInvoiceItems[index].total = currentInvoiceItems[index].price * newQuantity;
                    updateInvoiceItemsTable();
                });
            });

            // Add event listeners to remove buttons
            document.querySelectorAll('.remove-item').forEach(button => {
                button.addEventListener('click', function() {
                    const index = parseInt(this.dataset.index);
                    currentInvoiceItems.splice(index, 1);
                    updateInvoiceItemsTable();
                });
            });

            // Add event listeners to unit selects
            document.querySelectorAll('.unit-select').forEach(select => {
                select.addEventListener('change', function() {
                    const index = parseInt(this.dataset.index);
                    const medicine = medicines.find(m => m.id === currentInvoiceItems[index].id);
                    const newUnit = this.value;
                    const newPrice = getPriceByUnit(medicine, newUnit);

                    currentInvoiceItems[index].unit = newUnit;
                    currentInvoiceItems[index].price = newPrice;
                    currentInvoiceItems[index].total = newPrice * currentInvoiceItems[index].quantity;

                    updateInvoiceItemsTable();
                });
            });

            // Update totals
            const subtotal = currentInvoiceItems.reduce((sum, item) => sum + item.total, 0);
            const discount = parseFloat(document.getElementById('discount').value) || 0;
            const discountType = document.getElementById('discountType').value;

            let discountAmount = discount;
            if (discountType === 'percent') {
                discountAmount = subtotal * (discount / 100);
            }

            const total = subtotal - discountAmount;

            document.getElementById('subtotalAmount').textContent = formatCurrency(subtotal);
            document.getElementById('totalAmount').textContent = formatCurrency(total);
        }

        // Populate invoices list
        function populateInvoicesList() {
            const container = document.getElementById('invoicesList');
            if (!container) return;

            container.innerHTML = '';

            // Sort by date (newest first)
            const sortedInvoices = [...invoices].sort((a, b) => 
                new Date(b.date) - new Date(a.date)
            );

            sortedInvoices.forEach(invoice => {
                const invoiceCard = document.createElement('div');
                invoiceCard.className = 'invoice-card';
                invoiceCard.innerHTML = `
                    <div class="invoice-header">
                        <div class="invoice-id">${invoice.invoiceNumber}</div>
                        <div class="invoice-date">${formatDate(invoice.date)}</div>
                    </div>
                    <div class="invoice-customer">${invoice.customer.name}</div>
                    <div class="invoice-items">
                        ${invoice.items.map(item => `
                            <div class="invoice-item">
                                <div>${item.name}</div>
                                <div>${item.quantity} ${item.unit} x ${formatCurrency(item.price)}</div>
                            </div>
                        `).join('')}
                    </div>
                    <div class="invoice-total">Total: ${formatCurrency(invoice.total)}</div>
                    <span class="invoice-status ${invoice.status}">${invoice.status === 'paid' ? 'Paid' : 'Pending'}</span>
                    <button class="btn btn-danger btn-sm" style="margin-left: 10px;" onclick="deleteInvoice(${invoice.id})">
                        <i class="fas fa-trash"></i> Delete
                    </button>
                `;

                invoiceCard.addEventListener('click', function(e) {
                    if (!e.target.closest('.btn')) {
                        showInvoiceDetails(invoice);
                    }
                });

                container.appendChild(invoiceCard);
            });

            if (invoices.length === 0) {
                container.innerHTML = '<p>No invoices found</p>';
            }
        }

        // Show invoice details
        function showInvoiceDetails(invoice) {
            const container = document.getElementById('invoiceDetails');

            container.innerHTML = `
                <div class="invoice-header-details">
                    <div class="invoice-logo">PharmaInventory</div>
                    <div class="invoice-info">
                        <div class="invoice-title">INVOICE</div>
                        <div><strong>Invoice #:</strong> ${invoice.invoiceNumber}</div>
                        <div><strong>Date:</strong> ${formatDate(invoice.date)}</div>
                        <div><strong>Status:</strong> <span class="invoice-status ${invoice.status}">${invoice.status === 'paid' ? 'Paid' : 'Pending'}</span></div>
                    </div>
                </div>

                <div class="invoice-meta">
                    <div class="invoice-from">
                        <div class="invoice-section-title">From</div>
                        <div><strong>${settings.companyName}</strong></div>
                        <div>123 Pharmacy Street</div>
                        <div>Dhaka, Bangladesh</div>
                        <div>Phone: +880 1712345678</div>
                        <div>Email: info@pharmainventory.com</div>
                    </div>

                    <div class="invoice-to">
                        <div class="invoice-section-title">To</div>
                        <div><strong>${invoice.customer.name}</strong></div>
                        <div>${invoice.customer.address || 'No address provided'}</div>
                        <div>Phone: ${invoice.customer.phone || 'N/A'}</div>
                    </div>
                </div>

                <table class="invoice-table">
                    <thead>
                        <tr>
                            <th>Item</th>
                            <th>Unit</th>
                            <th>Unit Price</th>
                            <th>Quantity</th>
                            <th class="text-right">Amount</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${invoice.items.map(item => `
                            <tr>
                                <td>${item.name}</td>
                                <td>${item.unit}</td>
                                <td>${formatCurrency(item.price)}</td>
                                <td>${item.quantity}</td>
                                <td class="text-right">${formatCurrency(item.total)}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                    <tfoot>
                        <tr>
                            <td colspan="4" class="text-right">Subtotal</td>
                            <td class="text-right">${formatCurrency(invoice.subtotal)}</td>
                        </tr>
                        <tr>
                            <td colspan="4" class="text-right">Discount</td>
                            <td class="text-right">${formatCurrency(invoice.discount)}</td>
                        </tr>
                        <tr>
                            <td colspan="4" class="text-right"><strong>Total</strong></td>
                            <td class="text-right"><strong>${formatCurrency(invoice.total)}</strong></td>
                        </tr>
                    </tfoot>
                </table>

                <div class="print-only">
                    This is a computer generated invoice and does not require a signature.
                </div>
            `;

            // Show modal
            document.getElementById('invoiceModal').classList.add('show');
        }

        // Update dashboard statistics
        function updateDashboardStats() {
            const totalMedicines = medicines.length;

            const today = new Date();
            const expiringSoon = medicines.filter(m => {
                const expiryDate = new Date(m.expiry);
                const diffTime = expiryDate - today;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                return diffDays > 0 && diffDays <= settings.expiryThreshold;
            }).length;

            // Calculate today's sales
            const todayStr = today.toISOString().split('T')[0];
            const todaySales = recentSales
                .filter(sale => sale.date === todayStr)
                .reduce((sum, sale) => sum + sale.total, 0);

            // Calculate monthly profit (assuming 30% profit margin)
            const monthlyProfit = recentSales
                .filter(sale => {
                    const saleDate = new Date(sale.date);
                    return saleDate.getMonth() === today.getMonth() && saleDate.getFullYear() === today.getFullYear();
                })
                .reduce((sum, sale) => sum + (sale.total * 0.3), 0);

            document.getElementById('totalMedicines').textContent = totalMedicines;
            document.getElementById('expiringSoon').textContent = expiringSoon;
            document.getElementById('todaySales').textContent = formatCurrency(todaySales);
            document.getElementById('monthlyProfit').textContent = formatCurrency(monthlyProfit);
        }

        // Populate recent inventory table
        function populateRecentInventory() {
            const tbody = document.querySelector('#recentInventoryTable tbody');
            if (!tbody) return;

            tbody.innerHTML = '';

            // Sort by expiry date (soonest first)
            const sortedMedicines = [...medicines].sort((a, b) => 
                new Date(a.expiry) - new Date(b.expiry)
            );

            // Get the 5 soonest to expire
            const recentMedicines = sortedMedicines.slice(0, 5);

            recentMedicines.forEach(med => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${med.name}</td>
                    <td>${med.generic_name}</td>
                    <td>${med.type}</td>
                    <td>${med.stock} pieces</td>
                    <td>${formatCurrency(med.price)}</td>
                    <td>${formatDate(med.expiry)}</td>
                    <td><span class="badge ${getStatusClass(med.status)}">${med.status}</span></td>
                `;
                tbody.appendChild(row);
            });
        }

        // Populate recent sales table
        function populateRecentSales() {
            const tbody = document.querySelector('#recentSalesTable tbody');
            if (!tbody) return;

            tbody.innerHTML = '';

            // Get last 5 sales
            const recent = recentSales.slice(0, 5);

            recent.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${formatDate(item.date)}</td>
                    <td>${item.name}</td>
                    <td>${item.quantity} ${item.unit}</td>
                    <td>${formatCurrency(item.pricePerUnit)}</td>
                    <td>${formatCurrency(item.total)}</td>
                `;
                tbody.appendChild(row);
            });
        }

        // Populate full inventory table
        function populateInventoryTable() {
            const tbody = document.querySelector('#inventoryTable tbody');
            if (!tbody) return;

            tbody.innerHTML = '';

            medicines.forEach(med => {
                const row = document.createElement('tr');
                row.dataset.id = med.id;
                row.innerHTML = `
                    <td>${med.name}</td>
                    <td>${med.generic_name}</td>
                    <td>${med.type}</td>
                    <td>${med.power}</td>
                    <td>${med.company}</td>
                    <td>
                        <div class="stock-display">
                            <span>${med.stock} pieces</span>
                            <small>${Math.floor(med.stock / (med.stripsPerBox * med.piecesPerStrip))} boxes, 
                            ${Math.floor((med.stock % (med.stripsPerBox * med.piecesPerStrip)) / med.piecesPerStrip)} strips</small>
                        </div>
                    </td>
                    <td>
                        <div>Piece: ${formatCurrency(med.price)}</div>
                        <div>Strip: ${formatCurrency(med.boxPrice / med.stripsPerBox)}</div>
                        <div>Box: ${formatCurrency(med.boxPrice)}</div>
                    </td>
                    <td>${formatDate(med.expiry)}</td>
                    <td><span class="badge ${getStatusClass(med.status)}">${med.status}</span></td>
                    <td>
                        <button class="action-btn sell sell-btn"><i class="fas fa-cash-register"></i></button>
                        <button class="action-btn delete"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Add a new medicine to inventory table
        function addToInventoryTable(medicine) {
            const tbody = document.querySelector('#inventoryTable tbody');
            if (!tbody) return;

            const row = document.createElement('tr');
            row.dataset.id = medicine.id;
            row.innerHTML = `
                <td>${medicine.name}</td>
                <td>${medicine.generic_name}</td>
                <td>${medicine.type}</td>
                <td>${medicine.power}</td>
                <td>${medicine.company}</td>
                <td>
                    <div class="stock-display">
                        <span>${medicine.stock} pieces</span>
                        <small>${Math.floor(medicine.stock / (medicine.stripsPerBox * medicine.piecesPerStrip))} boxes, 
                        ${Math.floor((medicine.stock % (medicine.stripsPerBox * piecesPerStrip)) / medicine.piecesPerStrip)} strips</small>
                    </div>
                </td>
                <td>
                    <div>Piece: ${formatCurrency(medicine.price)}</div>
                    <div>Strip: ${formatCurrency(medicine.boxPrice / medicine.stripsPerBox)}</div>
                    <div>Box: ${formatCurrency(medicine.boxPrice)}</div>
                </td>
                <td>${formatDate(medicine.expiry)}</td>
                <td><span class="badge ${getStatusClass(medicine.status)}">${medicine.status}</span></td>
                <td>
                    <button class="action-btn sell sell-btn"><i class="fas fa-cash-register"></i></button>
                    <button class="action-btn delete"><i class="fas fa-trash"></i></button>
                </td>
            `;
            tbody.appendChild(row);
        }

        // Handle sell button click
        function handleSellButtonClick(row) {
            // Clear previous selling row
            document.querySelectorAll('.selling-row').forEach(r => r.classList.remove('selling-row'));

            // Mark current row
            row.classList.add('selling-row');

            const medicineId = parseInt(row.dataset.id);
            const medicine = medicines.find(m => m.id === medicineId);

            // Populate modal
            document.getElementById('sellMedicineName').value = medicine.name;
            document.getElementById('sellUnit').value = 'piece';
            document.getElementById('sellPrice').value = medicine.price;
            document.getElementById('sellQuantity').max = medicine.stock;
            document.getElementById('sellQuantity').value = 1;
            document.getElementById('sellDate').valueAsDate = new Date();

            // Show modal
            document.getElementById('sellModal').classList.add('show');
        }

        // Populate low stock table
        function populateLowStockTable() {
            const tbody = document.querySelector('#lowStockTable tbody');
            if (!tbody) return;

            tbody.innerHTML = '';

            // Filter medicines with low stock (less than 20 pieces or out of stock)
            const lowStockMedicines = medicines.filter(med => med.stock <= settings.lowStock);

            // Sort by stock level (lowest first)
            lowStockMedicines.sort((a, b) => a.stock - b.stock);

            lowStockMedicines.forEach(med => {
                const row = document.createElement('tr');
                row.dataset.id = med.id;

                // Add warning class for very low stock
                if (med.stock <= 5) {
                    row.classList.add('expiring-row');
                }

                row.innerHTML = `
                    <td>${med.name}</td>
                    <td>${med.generic_name}</td>
                    <td>${med.type}</td>
                    <td>${med.company}</td>
                    <td>
                        <div class="stock-display">
                            <span style="color: ${med.stock <= 5 ? 'var(--danger)' : 'var(--warning)'}; font-weight: bold;">
                                ${med.stock} pieces
                            </span>
                            <small>${Math.floor(med.stock / (med.stripsPerBox * med.piecesPerStrip))} boxes, 
                            ${Math.floor((med.stock % (med.stripsPerBox * med.piecesPerStrip)) / med.piecesPerStrip)} strips</small>
                        </div>
                    </td>
                    <td>
                        <div>Piece: ${formatCurrency(med.price)}</div>
                        <div>Strip: ${formatCurrency(med.boxPrice / med.stripsPerBox)}</div>
                        <div>Box: ${formatCurrency(med.boxPrice)}</div>
                    </td>
                    <td>${formatDate(med.expiry)}</td>
                    <td><span class="badge ${getStatusClass(med.status)}">${med.status}</span></td>
                    <td>
                        <button class="action-btn sell sell-btn" title="Sell Medicine"><i class="fas fa-cash-register"></i></button>
                        <button class="action-btn edit" title="Restock"><i class="fas fa-plus"></i></button>
                    </td>
                `;
                tbody.appendChild(row);
            });

            if (lowStockMedicines.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="9" style="text-align: center; color: var(--secondary); padding: 40px;">
                        <i class="fas fa-check-circle fa-3x" style="margin-bottom: 15px;"></i>
                        <p style="font-size: 1.2rem; margin: 0;">All medicines are well stocked!</p>
                    </td>
                `;
                tbody.appendChild(row);
            }
        }

        // Populate expiry alerts
        function populateExpiryAlerts() {
            const container = document.getElementById('expiryAlerts');
            if (!container) return;

            container.innerHTML = '';

            const today = new Date();
            const criticalThreshold = new Date();
            criticalThreshold.setDate(today.getDate() + 15);

            medicines.forEach(med => {
                const expiryDate = new Date(med.expiry);
                if (expiryDate < today) return; // Skip expired

                const diffTime = expiryDate - today;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

                if (diffDays <= settings.expiryThreshold) {
                    const alert = document.createElement('div');
                    alert.className = `expiry-alert ${diffDays <= 15 ? 'critical' : ''}`;
                    alert.innerHTML = `
                        <h4>${med.name}</h4>
                        <p>Expiry Date: ${formatDate(med.expiry)} (in ${diffDays} days)</p>
                        <p>Stock: ${med.stock} pieces | Status: <span class="badge ${getStatusClass(med.status)}">${med.status}</span></p>
                    `;
                    container.appendChild(alert);
                }
            });

            if (container.innerHTML === '') {
                container.innerHTML = '<p>No expiry alerts at this time</p>';
            }
        }

        // Update reports
        function updateReports() {
            // Weekly sales
            const today = new Date();
            const oneWeekAgo = new Date();
            oneWeekAgo.setDate(today.getDate() - 7);

            let weeklySales = 0;
            weeklySales += recentSales
                .filter(sale => {
                    const saleDate = new Date(sale.date);
                    return saleDate >= oneWeekAgo && saleDate <= today;
                })
                .reduce((sum, sale) => sum + sale.total, 0);

            weeklySales += invoices
                .filter(invoice => {
                    const invoiceDate = new Date(invoice.date);
                    return invoiceDate >= oneWeekAgo && invoiceDate <= today;
                })
                .reduce((sum, invoice) => sum + invoice.total, 0);

            // Monthly revenue
            let monthlyRevenue = 0;
            monthlyRevenue += recentSales
                .filter(sale => {
                    const saleDate = new Date(sale.date);
                    return saleDate.getMonth() === today.getMonth() && saleDate.getFullYear() === today.getFullYear();
                })
                .reduce((sum, sale) => sum + sale.total, 0);

            monthlyRevenue += invoices
                .filter(invoice => {
                    const invoiceDate = new Date(invoice.date);
                    return invoiceDate.getMonth() === today.getMonth() && invoiceDate.getFullYear() === today.getFullYear();
                })
                .reduce((sum, invoice) => sum + invoice.total, 0);

            // Top selling items
            const medicineCounts = {};

            recentSales.forEach(sale => {
                medicineCounts[sale.name] = (medicineCounts[sale.name] || 0) + sale.quantity;
            });

            invoices.forEach(invoice => {
                invoice.items.forEach(item => {
                    medicineCounts[item.name] = (medicineCounts[item.name] || 0) + item.quantity;
                });
            });

            const sortedMedicineCounts = Object.entries(medicineCounts)
                .sort(([, countA], [, countB]) => countB - countA);

            const topSellingItem = sortedMedicineCounts.length > 0 ? sortedMedicineCounts[0][0] : 'N/A';

            document.getElementById('weeklySales').textContent = formatCurrency(weeklySales);
            document.getElementById('monthlyRevenue').textContent = formatCurrency(monthlyRevenue);
            document.getElementById('topSelling').textContent = topSellingItem;

            // Update chart
            const chartLabels = sortedMedicineCounts.slice(0, 5).map(([name]) => name);
            const chartData = sortedMedicineCounts.slice(0, 5).map(([, count]) => count);
            updateChart(chartLabels, chartData);
        }

        // Function to update the chart
        function updateChart(labels, data, title = 'Top Selling Medicines', yLabel = 'Quantity Sold') {
            const chartCanvas = document.getElementById('salesChart');
            const chartTitle = document.getElementById('chartTitle');
            if (!chartCanvas) return;

            if (chartTitle) {
                chartTitle.textContent = title;
            }

            if (chartCanvas.chart) {
                chartCanvas.chart.destroy();
            }

            chartCanvas.chart = new Chart(chartCanvas.getContext('2d'), {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: yLabel,
                        data: data,
                        backgroundColor: 'rgba(0, 217, 126, 0.7)',
                        borderColor: 'rgba(0, 217, 126, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // Function to show weekly sales chart
        function showWeeklySalesChart() {
            const today = new Date();
            const currentWeek = getWeekNumber(today);
            const currentMonth = today.getMonth();
            const currentYear = today.getFullYear();

            const weeklySalesData = [0, 0, 0, 0]; // Week 1, 2, 3, 4
            const weekLabels = ['Week 1', 'Week 2', 'Week 3', 'Week 4'];

            // Calculate sales for each week of current month
            [...recentSales, ...invoices.map(inv => ({
                date: inv.date,
                total: inv.total
            }))].forEach(sale => {
                const saleDate = new Date(sale.date);
                if (saleDate.getMonth() === currentMonth && saleDate.getFullYear() === currentYear) {
                    const weekOfMonth = Math.ceil(saleDate.getDate() / 7) - 1;
                    if (weekOfMonth >= 0 && weekOfMonth < 4) {
                        weeklySalesData[weekOfMonth] += sale.total || 0;
                    }
                }
            });

            updateChart(weekLabels, weeklySalesData, 'Weekly Sales Report (Current Month)', 'Sales Amount (৳)');
        }

        // Function to show monthly revenue chart
        function showMonthlyRevenueChart() {
            const currentYear = new Date().getFullYear();
            const monthlyData = new Array(12).fill(0);
            const monthLabels = [
                'Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun',
                'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'
            ];

            // Calculate revenue for each month of current year
            [...recentSales, ...invoices.map(inv => ({
                date: inv.date,
                total: inv.total
            }))].forEach(sale => {
                const saleDate = new Date(sale.date);
                if (saleDate.getFullYear() === currentYear) {
                    const month = saleDate.getMonth();
                    monthlyData[month] += sale.total || 0;
                }
            });

            updateChart(monthLabels, monthlyData, 'Monthly Revenue Report (Current Year)', 'Revenue Amount (৳)');
        }

        // Function to show daily sales chart (last 30 days)
        function showDailySalesChart() {
            const dailySalesChart = document.getElementById('dailySalesChart');
            if (!dailySalesChart) return;

            const today = new Date();
            const dailyData = [];
            const dailyLabels = [];

            // Generate last 30 days
            for (let i = 29; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(today.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                
                dailyLabels.push(date.getDate().toString());
                
                // Calculate sales for this date
                let dayTotal = 0;
                
                // From recent sales
                dayTotal += recentSales
                    .filter(sale => sale.date === dateStr)
                    .reduce((sum, sale) => sum + sale.total, 0);
                
                // From invoices
                dayTotal += invoices
                    .filter(invoice => invoice.date === dateStr)
                    .reduce((sum, invoice) => sum + invoice.total, 0);
                
                dailyData.push(dayTotal);
            }

            if (dailySalesChart.chart) {
                dailySalesChart.chart.destroy();
            }

            dailySalesChart.chart = new Chart(dailySalesChart.getContext('2d'), {
                type: 'line',
                data: {
                    labels: dailyLabels,
                    datasets: [{
                        label: 'Daily Sales (৳)',
                        data: dailyData,
                        backgroundColor: 'rgba(44, 123, 229, 0.1)',
                        borderColor: 'rgba(44, 123, 229, 1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Day of Month'
                            }
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'Daily Sales - Last 30 Days'
                        }
                    }
                }
            });
        }

        // Function to navigate to a specific page
        function navigateToPage(pageId) {
            const navLinks = document.querySelectorAll('.nav-link');
            const pageContents = document.querySelectorAll('.page-content');
            const pageTitle = document.getElementById('page-title');

            navLinks.forEach(l => l.classList.remove('active'));
            const targetLink = document.querySelector(`.nav-link[data-page="${pageId}"]`);
            if (targetLink) {
                targetLink.classList.add('active');
                pageTitle.textContent = targetLink.querySelector('span').textContent;
            }

            pageContents.forEach(page => page.classList.remove('active'));
            const targetPage = document.getElementById(pageId);
            if (targetPage) {
                targetPage.classList.add('active');
                
                // Load appropriate data for the page
                if (pageId === 'inventory') {
                    populateInventoryTable();
                } else if (pageId === 'low-stocks') {
                    populateLowStockTable();
                } else if (pageId === 'invoices') {
                    populateInvoicesList();
                } else if (pageId === 'expiry') {
                    populateExpiryAlerts();
                } else if (pageId === 'reports') {
                    updateReports();
                    showDailySalesChart();
                    document.getElementById('reportDate').valueAsDate = new Date();
                    populateDailySalesReport(new Date().toISOString().split('T')[0]);
                }
            }
        }

        // Helper function to get week number
        function getWeekNumber(date) {
            const d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));
            const dayNum = d.getUTCDay() || 7;
            d.setUTCDate(d.getUTCDate() + 4 - dayNum);
            const yearStart = new Date(Date.UTC(d.getUTCFullYear(),0,1));
            return Math.ceil((((d - yearStart) / 86400000) + 1)/7);
        }

        // Populate daily sales report
        function populateDailySalesReport(date) {
            const container = document.getElementById('dailySalesBody');
            if (!container) return;

            container.innerHTML = '';

            const dailySales = [];

            recentSales.filter(sale => sale.date === date).forEach(sale => {
                dailySales.push({
                    invoiceNumber: sale.invoiceNumber || `SALE-${sale.id}`,
                    customer: sale.customer || 'Walk-in Customer',
                    items: 1,
                    total: sale.total,
                    time: new Date().toLocaleTimeString()
                });
            });

            invoices.filter(invoice => invoice.date === date).forEach(invoice => {
                dailySales.push({
                    invoiceNumber: invoice.invoiceNumber,
                    customer: invoice.customer.name,
                    items: invoice.items.length,
                    total: invoice.total,
                    time: new Date().toLocaleTimeString()
                });
            });

            let total = 0;

            dailySales.forEach(sale => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${sale.invoiceNumber}</td>
                    <td>${sale.customer}</td>
                    <td>${sale.items}</td>
                    <td>${formatCurrency(sale.total)}</td>
                    <td>${sale.time}</td>
                `;
                container.appendChild(row);
                total += sale.total;
            });

            if (dailySales.length > 0) {
                const totalRow = document.createElement('tr');
                totalRow.style.fontWeight = 'bold';
                totalRow.style.backgroundColor = '#f8f9fa';
                totalRow.innerHTML = `
                    <td colspan="3"><strong>Total Sales</strong></td>
                    <td><strong>${formatCurrency(total)}</strong></td>
                    <td></td>
                `;
                container.appendChild(totalRow);
            } else {
                const noDataRow = document.createElement('tr');
                noDataRow.innerHTML = `
                    <td colspan="5" style="text-align: center; color: #6c757d; padding: 20px;">No sales found for this date</td>
                `;
                container.appendChild(noDataRow);
            }
        }

        // Slide-out menu functionality
        function initializeSlideMenu() {
            const menuToggle = document.getElementById('menuToggle');
            const sidebar = document.getElementById('sidebar');
            const menuOverlay = document.getElementById('menuOverlay');
            const sidebarClose = document.getElementById('sidebarClose');

            // Show menu
            function showMenu() {
                sidebar.classList.add('active');
                menuOverlay.classList.add('active');
                document.body.style.overflow = 'hidden';
            }

            // Hide menu
            function hideMenu() {
                sidebar.classList.remove('active');
                menuOverlay.classList.remove('active');
                document.body.style.overflow = '';
            }

            // Menu toggle button click
            menuToggle.addEventListener('click', showMenu);

            // Close button click
            sidebarClose.addEventListener('click', hideMenu);

            // Overlay click
            menuOverlay.addEventListener('click', hideMenu);

            // Close menu when navigation link is clicked (mobile)
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', function() {
                    if (window.innerWidth <= 992) {
                        hideMenu();
                    }
                });
            });

            // Close menu on escape key
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && sidebar.classList.contains('active')) {
                    hideMenu();
                }
            });

            // Handle window resize
            window.addEventListener('resize', function() {
                if (window.innerWidth > 992) {
                    hideMenu();
                    sidebar.classList.remove('active');
                    menuOverlay.classList.remove('active');
                    document.body.style.overflow = '';
                }
            });
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize slide-out menu
            initializeSlideMenu();
            // Load settings into the settings page
            document.getElementById('companyName').value = settings.companyName;
            document.getElementById('currency').value = settings.currency;
            document.getElementById('expiryThreshold').value = settings.expiryThreshold;
            document.getElementById('lowStock').value = settings.lowStock;

            // Navigation
            const navLinks = document.querySelectorAll('.nav-link');
            const pageContents = document.querySelectorAll('.page-content');
            const pageTitle = document.getElementById('page-title');

            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();

                    navLinks.forEach(l => l.classList.remove('active'));
                    this.classList.add('active');

                    pageContents.forEach(page => {
                        page.classList.remove('active');
                    });

                    const pageId = this.getAttribute('data-page');
                    document.getElementById(pageId).classList.add('active');
                    pageTitle.textContent = this.querySelector('span').textContent;

                    if (pageId === 'dashboard') {
                        populateRecentInventory();
                        populateRecentSales();
                        updateDashboardStats();
                    }
                    else if (pageId === 'inventory') {
                        populateInventoryTable();
                    }
                    else if (pageId === 'low-stocks') {
                        populateLowStockTable();
                    }
                    else if (pageId === 'invoices') {
                        populateInvoicesList();
                    }
                    else if (pageId === 'expiry') {
                        populateExpiryAlerts();
                    }
                    else if (pageId === 'reports') {
                        updateReports();
                        showDailySalesChart();
                        document.getElementById('reportDate').valueAsDate = new Date();
                        populateDailySalesReport(new Date().toISOString().split('T')[0]);
                    }
                });
            });

            // Initialize dashboard with data
            updateDashboardStats();
            populateRecentInventory();
            populateRecentSales();
            populateInventoryTable();
            populateInvoicesList();
            updateReports();

            // View All buttons
            document.getElementById('viewAllInventory').addEventListener('click', function() {
                navLinks.forEach(l => l.classList.remove('active'));
                document.querySelector('.nav-link[data-page="inventory"]').classList.add('active');
                pageContents.forEach(page => page.classList.remove('active'));
                document.getElementById('inventory').classList.add('active');
                pageTitle.textContent = "Inventory";
            });

            // Search functionality
            document.getElementById('globalSearch').addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                const resultsContainer = document.getElementById('searchResults');

                if (searchTerm.length < 2) {
                    resultsContainer.classList.remove('show');
                    return;
                }

                const filtered = medicines.filter(med => 
                    med.name.toLowerCase().includes(searchTerm) || 
                    (med.generic_name && med.generic_name.toLowerCase().includes(searchTerm))
                ).slice(0, 5);

                if (filtered.length > 0) {
                    let html = '';
                    filtered.forEach(med => {
                        html += `
                        <div class="search-item" data-med='${JSON.stringify(med)}'>
                            <h4>${med.name}</h4>
                            <p>${med.generic_name || ''} | ${med.power || ''}</p>
                        </div>
                        `;
                    });
                    resultsContainer.innerHTML = html;
                    resultsContainer.classList.add('show');

                    document.querySelectorAll('.search-item').forEach(item => {
                        item.addEventListener('click', function() {
                            const med = JSON.parse(this.getAttribute('data-med'));
                            document.getElementById('globalSearch').value = med.name;
                            resultsContainer.classList.remove('show');

                            navLinks.forEach(l => l.classList.remove('active'));
                            document.querySelector('.nav-link[data-page="inventory"]').classList.add('active');
                            pageContents.forEach(page => page.classList.remove('active'));
                            document.getElementById('inventory').classList.add('active');
                            pageTitle.textContent = "Inventory";

                            setTimeout(() => {
                                const inventoryTable = document.getElementById('inventoryTable');
                                const rows = inventoryTable.querySelectorAll('tbody tr');
                                rows.forEach(row => {
                                    if (row.cells[0].textContent === med.name) {
                                        row.scrollIntoView({behavior: 'smooth', block: 'center'});
                                        row.classList.add('selling-row');
                                        setTimeout(() => row.classList.remove('selling-row'), 3000);
                                    }
                                });
                            }, 100);
                        });
                    });
                } else {
                    resultsContainer.innerHTML = '<div class="search-item">No medicines found</div>';
                    resultsContainer.classList.add('show');
                }
            });

            document.addEventListener('click', function(e) {
                if (!e.target.closest('.search-box')) {
                    document.getElementById('searchResults').classList.remove('show');
                }
            });

            // Add medicine form
            document.getElementById('addMedicineForm').addEventListener('submit', function(e) {
                e.preventDefault();

                const name = document.getElementById('medicineName').value;
                const generic = document.getElementById('genericName').value;
                const type = document.getElementById('medicineType').value;
                const power = document.getElementById('power').value;
                const company = document.getElementById('company').value;
                const boxPrice = parseFloat(document.getElementById('boxPrice').value);
                const stripsPerBox = parseInt(document.getElementById('stripsPerBox').value);
                const piecesPerStrip = parseInt(document.getElementById('piecesPerStrip').value);
                const boxes = parseInt(document.getElementById('boxes').value) || 0;
                const strips = parseInt(document.getElementById('strips').value) || 0;
                const pieces = parseInt(document.getElementById('pieces').value) || 0;
                const expiry = document.getElementById('expiryDate').value;

                const totalPieces = (boxes * stripsPerBox * piecesPerStrip) + 
                                   (strips * piecesPerStrip) + 
                                   pieces;
                const pricePerPiece = boxPrice / (stripsPerBox * piecesPerStrip);

                const medicine = {
                    id: medicines.length + 1,
                    name,
                    generic_name: generic,
                    type,
                    power,
                    company,
                    boxPrice,
                    stripsPerBox,
                    piecesPerStrip,
                    price: pricePerPiece,
                    stock: totalPieces,
                    expiry,
                    status: totalPieces > 0 ? 'In Stock' : 'Out of Stock'
                };

                medicines.push(medicine);
                saveAllData();
                addToInventoryTable(medicine);
                showToast('Medicine added to inventory successfully!', 'success');
                this.reset();
                updateDashboardStats();
            });

            // Event delegation for inventory table actions
            document.getElementById('inventoryTable').addEventListener('click', function(e) {
                const sellBtn = e.target.closest('.sell-btn');
                const deleteBtn = e.target.closest('.delete');

                if (sellBtn) {
                    const row = sellBtn.closest('tr');
                    handleSellButtonClick(row);
                }
                else if (deleteBtn) {
                    const row = deleteBtn.closest('tr');
                    const medicineName = row.cells[0].textContent;
                    if (confirm(`Are you sure you want to delete ${medicineName}?`)) {
                        const medicineId = parseInt(row.dataset.id);
                        medicines = medicines.filter(m => m.id !== medicineId);
                        saveAllData();
                        row.remove();
                        showToast(`${medicineName} deleted from inventory`, 'success');
                        updateDashboardStats();
                    }
                }
            });

            // Close modal buttons
            document.querySelectorAll('.modal-close').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.getElementById('sellModal').classList.remove('show');
                    document.getElementById('invoiceModal').classList.remove('show');
                    document.getElementById('createInvoiceModal').classList.remove('show');
                    document.getElementById('importModal').classList.remove('show');
                    document.querySelectorAll('.selling-row').forEach(row => row.classList.remove('selling-row'));
                });
            });

            // Confirm sell button
            document.getElementById('confirmSell').addEventListener('click', function() {
                const name = document.getElementById('sellMedicineName').value;
                const unit = document.getElementById('sellUnit').value;
                const price = parseFloat(document.getElementById('sellPrice').value);
                const quantity = parseInt(document.getElementById('sellQuantity').value);
                const date = document.getElementById('sellDate').value;

                const row = document.querySelector('.selling-row');
                if (row) {
                    const medicineId = parseInt(row.dataset.id);
                    const medicine = medicines.find(m => m.id === medicineId);
                    const piecesSold = getPiecesByUnit(medicine, unit, quantity);

                    if (piecesSold > medicine.stock) {
                        showToast(`Not enough stock! Available: ${medicine.stock} pieces`, 'error');
                        return;
                    }

                    medicine.stock -= piecesSold;

                    if (medicine.stock <= 0) {
                        medicine.status = 'Out of Stock';
                    } else if (medicine.stock < 10) {
                        medicine.status = 'Low Stock';
                    } else {
                        medicine.status = 'In Stock';
                    }

                    const sale = {
                        id: recentSales.length + 1,
                        date: date,
                        name: name,
                        unit: unit,
                        quantity: quantity,
                        pricePerUnit: price,
                        total: price * quantity
                    };

                    recentSales.unshift(sale);
                    if (recentSales.length > 10) recentSales.pop();

                    saveAllData();
                    populateRecentSales();
                    populateInventoryTable();
                    row.classList.remove('selling-row');
                }

                showToast(`Sold ${quantity} ${unit} of ${name} for ${formatCurrency(price * quantity)}`, 'success');
                document.getElementById('sellModal').classList.remove('show');
                updateDashboardStats();
                updateReports();
            });

            // Report date change handler
            document.getElementById('reportDate').addEventListener('change', function() {
                const selectedDate = this.value;
                if (selectedDate) {
                    populateDailySalesReport(selectedDate);
                }
            });

            document.getElementById('reportDate').valueAsDate = new Date();
            populateDailySalesReport(new Date().toISOString().split('T')[0]);

            // Export inventory
            document.getElementById('exportInventory').addEventListener('click', function() {
                let csv = 'Medicine,Generic,Type,Power,Company,Stock,Price,Expiry,Status\n';

                medicines.forEach(med => {
                    csv += `"${med.name}","${med.generic_name}","${med.type}","${med.power}","${med.company}",${med.stock},${med.price},"${med.expiry}","${med.status}"\n`;
                });

                const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement("a");
                link.setAttribute("href", url);
                link.setAttribute("download", "inventory.csv");
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);

                showToast('Inventory exported to CSV', 'success');
            });

            // Export low stock
            document.getElementById('exportLowStock').addEventListener('click', function() {
                const lowStockMedicines = medicines.filter(med => med.stock <= settings.lowStock);

                let csv = 'Medicine,Generic,Type,Company,Current Stock,Price per Piece,Expiry,Status\n';

                lowStockMedicines.forEach(med => {
                    csv += `"${med.name}","${med.generic_name}","${med.type}","${med.company}",${med.stock},${med.price},"${med.expiry}","${med.status}"\n`;
                });

                const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement("a");
                link.setAttribute("href", url);
                link.setAttribute("download", "low-stock-medicines.csv");
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);

                showToast('Low stock medicines exported to CSV', 'success');
            });

            // Low stock search functionality
            document.getElementById('lowStockSearch').addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                const rows = document.querySelectorAll('#lowStockTable tbody tr');

                rows.forEach(row => {
                    if (row.children.length === 1) return;

                    const medicineName = row.children[0].textContent.toLowerCase();
                    const genericName = row.children[1].textContent.toLowerCase();
                    const company = row.children[3].textContent.toLowerCase();

                    if (medicineName.includes(searchTerm) || 
                        genericName.includes(searchTerm) || 
                        company.includes(searchTerm)) {
                        row.style.display = '';
                    } else {
                        row.style.display = 'none';
                    }
                });
            });

            // Sync data button
            document.getElementById('syncData').addEventListener('click', function() {
                updateDashboardStats();
                populateRecentInventory();
                populateRecentSales();
                populateInventoryTable();
                populateInvoicesList();
                showToast('Data synchronized successfully', 'success');
            });

            // Create Invoice button
            document.getElementById('createInvoice').addEventListener('click', function() {
                document.getElementById('invoiceForm').reset();
                currentInvoiceItems = [];
                updateInvoiceItemsTable();
                document.getElementById('invoiceDate').valueAsDate = new Date();
                document.getElementById('createInvoiceModal').classList.add('show');
            });

            // Save Invoice button
            document.getElementById('saveInvoice').addEventListener('click', function() {
                const customerName = document.getElementById('customerName').value;
                const customerPhone = document.getElementById('customerPhone').value;
                const customerAddress = document.getElementById('customerAddress').value;
                const invoiceDate = document.getElementById('invoiceDate').value;
                const discount = parseFloat(document.getElementById('discount').value) || 0;
                const discountType = document.getElementById('discountType').value;

                if (!customerName) {
                    showToast('Customer name is required', 'error');
                    return;
                }

                if (currentInvoiceItems.length === 0) {
                    showToast('Please add at least one medicine to the invoice', 'error');
                    return;
                }

                const subtotal = currentInvoiceItems.reduce((sum, item) => sum + item.total, 0);

                let discountAmount = discount;
                if (discountType === 'percent') {
                    discountAmount = subtotal * (discount / 100);
                }

                const total = subtotal - discountAmount;

                const newInvoice = {
                    id: nextInvoiceId++,
                    invoiceNumber: `INV-${new Date().getFullYear()}-${nextInvoiceId.toString().padStart(3, '0')}`,
                    date: invoiceDate,
                    customer: {
                        name: customerName,
                        phone: customerPhone,
                        address: customerAddress
                    },
                    items: [...currentInvoiceItems],
                    subtotal: subtotal,
                    discount: discountAmount,
                    total: total,
                    status: 'paid'
                };

                invoices.push(newInvoice);

                newInvoice.items.forEach(item => {
                    const medicine = medicines.find(m => m.id === item.id);
                    if (medicine) {
                        const piecesSold = getPiecesByUnit(medicine, item.unit, item.quantity);
                        medicine.stock -= piecesSold;
                        if (medicine.stock <= 0) {
                            medicine.status = 'Out of Stock';
                        } else if (medicine.stock < 10) {
                            medicine.status = 'Low Stock';
                        }
                    }
                });

                saveAllData();
                populateInventoryTable();
                showToast('Invoice created successfully!', 'success');
                document.getElementById('createInvoiceModal').classList.remove('show');

                if (document.getElementById('invoices').classList.contains('active')) {
                    populateInvoicesList();
                }

                updateDashboardStats();
            });

            // Medicine search in invoice creation
            document.getElementById('medicineSearch').addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                const resultsContainer = document.getElementById('medicineSearchResults');

                if (searchTerm.length < 2) {
                    resultsContainer.classList.remove('show');
                    return;
                }

                const filtered = medicines.filter(med => 
                    med.name.toLowerCase().includes(searchTerm) || 
                    (med.generic_name && med.generic_name.toLowerCase().includes(searchTerm))
                ).slice(0, 5);

                if (filtered.length > 0) {
                    let html = '';
                    filtered.forEach(med => {
                        html += `
                        <div class="search-item" data-med='${JSON.stringify(med)}'>
                            <h4>${med.name}</h4>
                            <p>${med.generic_name || ''} | Stock: ${med.stock} | ${formatCurrency(med.price)}/piece</p>
                        </div>
                        `;
                    });
                    resultsContainer.innerHTML = html;
                    resultsContainer.classList.add('show');

                    document.querySelectorAll('#medicineSearchResults .search-item').forEach(item => {
                        item.addEventListener('click', function() {
                            const med = JSON.parse(this.getAttribute('data-med'));
                            document.getElementById('medicineSearch').value = '';
                            resultsContainer.classList.remove('show');

                            const existingItem = currentInvoiceItems.find(i => i.id === med.id);
                            if (existingItem) {
                                existingItem.quantity += 1;
                                existingItem.total = existingItem.price * existingItem.quantity;
                            } else {
                                currentInvoiceItems.push({
                                    id: med.id,
                                    name: med.name,
                                    unit: 'piece',
                                    price: med.price,
                                    quantity: 1,
                                    total: med.price
                                });
                            }

                            updateInvoiceItemsTable();
                        });
                    });
                } else {
                    resultsContainer.innerHTML = '<div class="search-item">No medicines found</div>';
                    resultsContainer.classList.add('show');
                }
            });

            // Print Invoice button
            document.getElementById('printInvoice').addEventListener('click', function() {
                window.print();
            });

            // Export invoices button
            document.getElementById('exportInvoices').addEventListener('click', function() {
                let csv = 'Invoice Number,Date,Customer Name,Phone,Address,Subtotal,Discount,Total,Status\n';

                invoices.forEach(inv => {
                    csv += `"${inv.invoiceNumber}","${inv.date}","${inv.customer.name}","${inv.customer.phone}","${inv.customer.address}",${inv.subtotal},${inv.discount},${inv.total},"${inv.status}"\n`;
                });

                const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement("a");
                link.setAttribute("href", url);
                link.setAttribute("download", "invoices.csv");
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);

                showToast('Invoices exported to CSV', 'success');
            });

            // Print all invoices button
            document.getElementById('printAllInvoices').addEventListener('click', function() {
                showToast('All invoices are ready for printing', 'info');
            });

            // Backup data button
            document.getElementById('backupData').addEventListener('click', backupData);

            // Clear all data button
            document.getElementById('clearData').addEventListener('click', function() {
                if (confirm('Are you sure you want to clear ALL data? This cannot be undone.')) {
                    localStorage.clear();
                    medicines = [];
                    recentSales = [];
                    invoices = [];
                    nextInvoiceId = 3;
                    settings = defaultSettings;

                    populateRecentInventory();
                    populateRecentSales();
                    populateInventoryTable();
                    populateInvoicesList();
                    updateDashboardStats();
                    updateReports();

                    document.getElementById('companyName').value = settings.companyName;
                    document.getElementById('currency').value = settings.currency;
                    document.getElementById('expiryThreshold').value = settings.expiryThreshold;
                    document.getElementById('lowStock').value = settings.lowStock;

                    showToast('All data has been cleared', 'success');
                }
            });

            // Restore data button
            document.getElementById('restoreData').addEventListener('click', function() {
                document.getElementById('importModal').classList.add('show');
            });

            // Confirm import button
            document.getElementById('confirmImport').addEventListener('click', function() {
                const fileInput = document.getElementById('importFile');
                const replace = document.getElementById('replaceData').checked;

                if (!fileInput.files.length) {
                    showToast('Please select a file to import', 'error');
                    return;
                }

                const file = fileInput.files[0];
                const reader = new FileReader();

                reader.onload = function(e) {
                    try {
                        const data = JSON.parse(e.target.result);

                        if (replace) {
                            medicines = data.medicines || [];
                            recentSales = data.recentSales || [];
                            invoices = data.invoices || [];
                            nextInvoiceId = data.nextInvoiceId || 3;
                            settings = data.settings || defaultSettings;
                        } else {
                            medicines = [...medicines, ...(data.medicines || [])];
                            recentSales = [...recentSales, ...(data.recentSales || [])];
                            invoices = [...invoices, ...(data.invoices || [])];
                            nextInvoiceId = Math.max(nextInvoiceId, data.nextInvoiceId || 3);
                            settings = { ...settings, ...(data.settings || {}) };
                        }

                        saveAllData();

                        populateRecentInventory();
                        populateRecentSales();
                        populateInventoryTable();
                        populateInvoicesList();
                        updateDashboardStats();
                        updateReports();

                        document.getElementById('companyName').value = settings.companyName;
                        document.getElementById('currency').value = settings.currency;
                        document.getElementById('expiryThreshold').value = settings.expiryThreshold;
                        document.getElementById('lowStock').value = settings.lowStock;

                        showToast('Data imported successfully!', 'success');
                        document.getElementById('importModal').classList.remove('show');
                    } catch (error) {
                        showToast('Error parsing the backup file', 'error');
                        console.error('Import error:', error);
                    }
                };

                reader.readAsText(file);
            });

            // Settings save functionality
            document.getElementById('saveSettings').addEventListener('click', function() {
                settings.companyName = document.getElementById('companyName').value;
                settings.currency = document.getElementById('currency').value;
                settings.expiryThreshold = parseInt(document.getElementById('expiryThreshold').value);
                settings.lowStock = parseInt(document.getElementById('lowStock').value);

                saveSettings(settings);
                saveAllData();

                showToast('Settings saved successfully!', 'success');

                updateDashboardStats();
                populateRecentInventory();
                populateRecentSales();
                populateInventoryTable();
                populateLowStockTable();
                populateExpiryAlerts();
                updateReports();
            });

            // Daily sales report date change
            document.getElementById('reportDate').addEventListener('change', function() {
                populateDailySalesReport(this.value);
            });

            // Weekly sales card click handler
            document.getElementById('weeklySalesCard').addEventListener('click', function() {
                showWeeklySalesChart();
            });

            // Monthly revenue card click handler
            document.getElementById('monthlyRevenueCard').addEventListener('click', function() {
                showMonthlyRevenueChart();
            });

            // Daily sales card click handler
            document.getElementById('dailySalesCard').addEventListener('click', function() {
                navigateToPage('reports');
                setTimeout(() => showDailySalesChart(), 100);
            });

            // Dashboard stat card navigation
            document.getElementById('totalMedicinesCard').addEventListener('click', function() {
                navigateToPage('inventory');
            });

            document.getElementById('expiringSoonCard').addEventListener('click', function() {
                navigateToPage('expiry');
            });

            document.getElementById('todaySalesCard').addEventListener('click', function() {
                navigateToPage('invoices');
            });

            document.getElementById('monthlyProfitCard').addEventListener('click', function() {
                navigateToPage('reports');
            });

             // Common Bangladesh medicines database for suggestions
            const commonMedicines = [
                { name: "Paracetamol", generic: "Acetaminophen", company: "Various", power: "500 mg", type: "tablet", stripsPerBox: 10, piecesPerStrip: 10, boxPrice: 120.00 },
                { name: "Napa", generic: "Paracetamol", company: "Beximco Pharmaceuticals Ltd.", power: "500 mg", type: "tablet", stripsPerBox: 10, piecesPerStrip: 10, boxPrice: 150.00 },
                { name: "Ace", generic: "Paracetamol", company: "Square Pharmaceuticals Ltd.", power: "500 mg", type: "tablet", stripsPerBox: 10, piecesPerStrip: 10, boxPrice: 140.00 },
                { name: "Napa Extra", generic: "Paracetamol + Caffeine", company: "Beximco Pharmaceuticals Ltd.", power: "500 mg + 65 mg", type: "tablet", stripsPerBox: 10, piecesPerStrip: 10, boxPrice: 180.00 },
                { name: "Sergel", generic: "Sertraline", company: "Incepta Pharmaceuticals Ltd.", power: "50 mg", type: "tablet", stripsPerBox: 3, piecesPerStrip: 10, boxPrice: 450.00 },
                { name: "Fexo", generic: "Fexofenadine", company: "Square Pharmaceuticals Ltd.", power: "120 mg", type: "tablet", stripsPerBox: 2, piecesPerStrip: 10, boxPrice: 200.00 },
                { name: "Flexi", generic: "Aceclofenac", company: "Square Pharmaceuticals Ltd.", power: "100 mg", type: "tablet", stripsPerBox: 5, piecesPerStrip: 10, boxPrice: 250.00 },
                { name: "Ciprocin", generic: "Ciprofloxacin", company: "Square Pharmaceuticals Ltd.", power: "500 mg", type: "tablet", stripsPerBox: 1, piecesPerStrip: 10, boxPrice: 120.00 },
                { name: "Amodis", generic: "Amlodipine", company: "Incepta Pharmaceuticals Ltd.", power: "5 mg", type: "tablet", stripsPerBox: 3, piecesPerStrip: 10, boxPrice: 90.00 },
                { name: "Losazep", generic: "Losartan", company: "Incepta Pharmaceuticals Ltd.", power: "50 mg", type: "tablet", stripsPerBox: 3, piecesPerStrip: 10, boxPrice: 180.00 },
                { name: "Metfo", generic: "Metformin", company: "Square Pharmaceuticals Ltd.", power: "500 mg", type: "tablet", stripsPerBox: 10, piecesPerStrip: 10, boxPrice: 200.00 },
                { name: "Omidon", generic: "Omeprazole", company: "Square Pharmaceuticals Ltd.", power: "20 mg", type: "capsule", stripsPerBox: 3, piecesPerStrip: 10, boxPrice: 150.00 },
                { name: "Pantonix", generic: "Pantoprazole", company: "Incepta Pharmaceuticals Ltd.", power: "40 mg", type: "tablet", stripsPerBox: 3, piecesPerStrip: 10, boxPrice: 180.00 },
                { name: "Montair", generic: "Montelukast", company: "Cipla Ltd.", power: "10 mg", type: "tablet", stripsPerBox: 3, piecesPerStrip: 10, boxPrice: 300.00 },
                { name: "Seclo", generic: "Omeprazole", company: "Square Pharmaceuticals Ltd.", power: "20 mg", type: "capsule", stripsPerBox: 3, piecesPerStrip: 10, boxPrice: 120.00 },
                { name: "Zimax", generic: "Azithromycin", company: "Square Pharmaceuticals Ltd.", power: "500 mg", type: "tablet", stripsPerBox: 1, piecesPerStrip: 3, boxPrice: 90.00 },
                { name: "Monas", generic: "Montelukast", company: "Square Pharmaceuticals Ltd.", power: "10 mg", type: "tablet", stripsPerBox: 3, piecesPerStrip: 10, boxPrice: 270.00 },
                { name: "Maxpro", generic: "Esomeprazole", company: "Renata Limited", power: "40 mg", type: "tablet", stripsPerBox: 3, piecesPerStrip: 10, boxPrice: 360.00 },
                { name: "Amoxil", generic: "Amoxicillin", company: "Square Pharmaceuticals Ltd.", power: "500 mg", type: "capsule", stripsPerBox: 2, piecesPerStrip: 10, boxPrice: 160.00 },
                { name: "Ditec", generic: "Diclofenac", company: "Incepta Pharmaceuticals Ltd.", power: "50 mg", type: "tablet", stripsPerBox: 5, piecesPerStrip: 10, boxPrice: 200.00 },
                { name: "Napa Syrup", generic: "Paracetamol", company: "Beximco Pharmaceuticals Ltd.", power: "120 mg/5ml", type: "syrup", stripsPerBox: 1, piecesPerStrip: 1, boxPrice: 45.00 },
                { name: "Ambrox", generic: "Ambroxol", company: "Square Pharmaceuticals Ltd.", power: "30 mg/5ml", type: "syrup", stripsPerBox: 1, piecesPerStrip: 1, boxPrice: 60.00 },
                { name: "Antacid", generic: "Aluminum Hydroxide + Magnesium Hydroxide", company: "Square Pharmaceuticals Ltd.", power: "400mg + 400mg", type: "suspension", stripsPerBox: 1, piecesPerStrip: 1, boxPrice: 80.00 },
                { name: "Insulin", generic: "Human Insulin", company: "Novo Nordisk", power: "100 IU/ml", type: "injection", stripsPerBox: 5, piecesPerStrip: 1, boxPrice: 800.00 },
                { name: "Naselin", generic: "Oxymetazoline", company: "Square Pharmaceuticals Ltd.", power: "0.05%", type: "drop", stripsPerBox: 1, piecesPerStrip: 1, boxPrice: 25.00 }
            ];

            // Medicine name suggestions
            document.getElementById('medicineName').addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                const suggestionsContainer = document.getElementById('medicineNameSuggestions');

                if (searchTerm.length < 2) {
                    suggestionsContainer.style.display = 'none';
                    return;
                }

                // Use comprehensive local medicine database
                showLocalSuggestions(searchTerm, suggestionsContainer);

                function showLocalSuggestions(searchTerm, container) {
                    // Use comprehensive medicine database if available, fallback to common medicines
                    let filtered = [];
                    
                    if (typeof searchMedicines !== 'undefined' && typeof comprehensiveMedicines !== 'undefined') {
                        // Use the optimized search function from the comprehensive database
                        filtered = searchMedicines(searchTerm, 10);
                    } else if (typeof commonMedicines !== 'undefined') {
                        // Fallback to original common medicines or comprehensive if available
                        const medicineList = window.commonMedicines || commonMedicines;
                        filtered = medicineList.filter(med => 
                            med.name.toLowerCase().includes(searchTerm.toLowerCase()) || 
                            med.generic.toLowerCase().includes(searchTerm.toLowerCase())
                        ).slice(0, 10);
                    }

                    if (filtered.length > 0) {
                        let html = '';
                        filtered.forEach(item => {
                            const powerText = item.power ? ` - ${item.power}` : '';
                            const packText = `${item.stripsPerBox} x ${item.piecesPerStrip}: ৳${item.boxPrice.toFixed(2)}`;
                            
                            html += `
                                <div class="search-item" data-name="${item.name}" data-generic="${item.generic}" 
                                     data-company="${item.company}" data-power="${item.power}" 
                                     data-type="${item.type}" data-strips="${item.stripsPerBox}" 
                                     data-pieces="${item.piecesPerStrip}" data-boxprice="${item.boxPrice}">
                                    <h4>${item.name}${powerText}</h4>
                                    <p>${item.generic} | ${item.type} | ${packText}</p>
                                    <small style="color: #666;">${item.company}</small>
                                </div>
                            `;
                        });
                        container.innerHTML = html;
                        container.style.display = 'block';
                        addSuggestionClickListeners();
                    } else {
                        container.innerHTML = '<div class="search-item">No suggestions found</div>';
                        container.style.display = 'block';
                    }
                }

                function addSuggestionClickListeners() {
                    document.querySelectorAll('#medicineNameSuggestions .search-item').forEach(item => {
                        item.addEventListener('click', function() {
                            const name = this.dataset.name;
                            const generic = this.dataset.generic;
                            const company = this.dataset.company;
                            const power = this.dataset.power;
                            const type = this.dataset.type;
                            const stripsPerBox = this.dataset.strips;
                            const piecesPerStrip = this.dataset.pieces;
                            const boxPrice = this.dataset.boxprice;

                            document.getElementById('medicineName').value = name;
                            
                            // Auto-fill other fields if available
                            if (generic && generic !== 'undefined') {
                                document.getElementById('genericName').value = generic;
                            }
                            if (company && company !== 'undefined') {
                                document.getElementById('company').value = company;
                            }
                            if (power && power !== 'undefined') {
                                document.getElementById('power').value = power;
                            }
                            if (type && type !== 'undefined') {
                                document.getElementById('medicineType').value = type;
                            }
                            if (stripsPerBox && stripsPerBox !== 'undefined') {
                                document.getElementById('stripsPerBox').value = stripsPerBox;
                            }
                            if (piecesPerStrip && piecesPerStrip !== 'undefined') {
                                document.getElementById('piecesPerStrip').value = piecesPerStrip;
                            }
                            if (boxPrice && boxPrice !== 'undefined') {
                                document.getElementById('boxPrice').value = parseFloat(boxPrice);
                            }
                            
                            suggestionsContainer.style.display = 'none';
                        });
                    });
                }
            });

            // Close suggestions on outside click
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.search-box')) {
                    document.getElementById('medicineNameSuggestions').style.display = 'none';
                }
            });
        });
    </script>
    <script src="js/medicine-database.js"></script>
    <script>
        // Override the commonMedicines with comprehensive database
        if (typeof comprehensiveMedicines !== 'undefined') {
            console.log('Loaded comprehensive medicine database with', comprehensiveMedicines.length, 'medicines');
            // Replace the limited commonMedicines array
            window.commonMedicines = comprehensiveMedicines;
        } else {
            console.error('Failed to load comprehensive medicine database');
        }
    </script>
</body>
</html>